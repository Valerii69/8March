import React, { useEffect, useRef, useState } from "react";
import "./index.css";
import { gsap } from "gsap"; // GSAP –¥–ª—è –∞–Ω—ñ–º–∞—Ü—ñ—ó
import Typed from "typed.js"; // Typed.js –¥–ª—è —Ç–µ–∫—Å—Ç—É
import Carpet from "./carpetSmoll.png"; // –Ü–º–ø–æ—Ä—Ç –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è

function App() {
  const petalsRef = useRef(null);
  const textRef = useRef(null);
  const authorRef = useRef(null);
  const carpetRef = useRef(null); // üëà –î–æ–¥–∞—î–º–æ ref –¥–ª—è –∫–∏–ª–∏–º–∞
  const [showCarpet, setShowCarpet] = useState(false); // –°—Ç–∞–Ω –¥–ª—è –∫–∏–ª–∏–º–∞

  useEffect(() => {
    const warp = petalsRef.current;
    const total = 50;
    const w = window.innerWidth;
    const h = window.innerHeight;

    if (!warp) return;

    for (let i = 0; i < total; i++) {
      const div = document.createElement("div");
      gsap.set(div, {
        attr: { class: "dot" },
        x: R(0, w),
        y: R(-200, -150),
        z: R(-200, 200),
      });
      warp.appendChild(div);
      animm(div, h);
    }

    function animm(elm, h) {
      gsap.to(elm, {
        duration: R(6, 15),
        y: h + 100,
        ease: "none",
        repeat: -1,
        delay: -15,
      });
      gsap.to(elm, {
        duration: R(4, 8),
        x: "+=100",
        rotationZ: R(0, 180),
        repeat: -1,
        yoyo: true,
        ease: "sine.inOut",
      });
      gsap.to(elm, {
        duration: R(2, 8),
        rotationX: R(0, 360),
        rotationY: R(0, 360),
        repeat: -1,
        yoyo: true,
        ease: "sine.inOut",
        delay: -5,
      });
    }

    function R(min, max) {
      return min + Math.random() * (max - min);
    }

    // –ê–Ω—ñ–º–∞—Ü—ñ—è —Ç–µ–∫—Å—Ç—É Typed.js
    if (textRef.current) {
      const typed = new Typed(textRef.current, {
        // strings: [
        //   "–ó 8 –±–µ—Ä–µ–∑–Ω—è –≤—ñ—Ç–∞—é! <br> –í–∏–±–∞—á, –∫–≤—ñ—Ç—ñ–≤ –Ω–µ –¥–∞—Ä—é, <br> –í—ñ–¥ –¥—É—à—ñ –ø–æ–∑–¥–æ—Ä–æ–≤–ª—è—é <br> –Ü –ª–∏—Å—Ç–∞ —Ç–æ–±—ñ —è —à–ª—é. <br>–í –Ω—å–æ–º—É –ø—Ä–æ—Å—Ç–æ –≤—Å–µ –π –∫—Ä–∞—Å–∏–≤–æ,<br> –¢–µ–ø–ª–æ—Ç–∞ –º–æ—ó—Ö –¥—É–º–æ–∫,<br> –•–æ—á—É, —â–æ–± –∂–∏–ª–∞ —â–∞—Å–ª–∏–≤–æ, <br> –ù–∞–π–ø—Ä–µ–∫—Ä–∞—Å–Ω—ñ—à–∞ –∑ –∂—ñ–Ω–æ–∫.",
        // ],
        strings: [
          "–ù–µ—Ö–∞–π —Ç–µ–Ω–¥—ñ—Ç–Ω—ñ –ø–∞—Ö–æ—â—ñ —Ç—Ä–æ—è–Ω–¥<br> –ù–∞–≤—ñ—é—Ç—å —â–∞—Å—Ç—è, –Ω—ñ–∂–Ω—ñ—Å—Ç—å —ñ –∫–æ—Ö–∞–Ω–Ω—è,<br>–•–∞–π –∑–¥—ñ–π—Å–Ω—é—î –±–∞–∂–∞–Ω–Ω—è –∑–æ—Ä–µ–ø–∞–¥<br> –Ü –≤—Ç—ñ–ª—é—î —É –¥—ñ–π—Å–Ω—ñ—Å—Ç—å —Å–ø–æ–¥—ñ–≤–∞–Ω–Ω—è! <br>–ù–µ—Ö–∞–π —Ç–æ–±—ñ –≤–¥–∞—î—Ç—å—Å—è –≤—Å–µ ‚Äî –≤–¥–µ–Ω—å, –≤–Ω–æ—á—ñ,<br> –•–∞–π –æ—á—ñ –ø–æ—Å–º—ñ—Ö–∞—é—Ç—å—Å—è –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω–æ,<br> –Ü —Å–º–∞–∫ –∂–∏—Ç—Ç—è, —ñ –º–æ–ª–æ–¥—ñ—Å—Ç—å –¥—É—à—ñ <br>–ù–µ—Ö–∞–π –¥–ª—è —Ç–µ–±–µ —Ç—Ä–∏–≤–∞—é—Ç—å  –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–æ!",
        ],
        startDelay: 3000,
        typeSpeed: 50,
        backSpeed: 0,
        fadeOut: true,
        loop: false,
        showCursor: false,
        onComplete: function () {
          if (authorRef.current) {
            authorRef.current.style.opacity = 1;
            setShowCarpet(true); // –í–º–∏–∫–∞—î–º–æ –∫–∏–ª–∏–º –ø—ñ—Å–ª—è —Ç–µ–∫—Å—Ç—É
          }
        },
      });

      return () => typed.destroy();
    }
  }, []);

  // –î–æ–¥–∞—î–º–æ –∫–ª–∞—Å "show" –ø—ñ—Å–ª—è —Ä–µ–Ω–¥–µ—Ä—É –∫–∏–ª–∏–º–∞
  useEffect(() => {
    if (showCarpet && carpetRef.current) {
      requestAnimationFrame(() => {
        carpetRef.current.classList.add("show");
      });
    }
  }, [showCarpet]);

  return (
    <div>
      {/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø–µ–ª—é—Å—Ç–æ–∫ */}
      <div id="petals" ref={petalsRef}></div>

      {/* –ë–ª–æ–∫ –¥–ª—è –∞–Ω—ñ–º–∞—Ü—ñ—ó —Ç–µ–∫—Å—Ç—É */}
      <div id="scene">
        <div id="card">
          <p id="greeting">–õ—é–±–∞, –∑ 8 –±–µ—Ä–µ–∑–Ω—è!</p>
          <p>
            <span id="text" ref={textRef}></span>
          </p>
          <p id="author" ref={authorRef} style={{ opacity: 0 }}>
            –ó –ª—é–±–æ–≤'—é –í–∞–ª–µ—Ä–∞
          </p>
          {/* –ö–∏–ª–∏–º –∑‚Äô—è–≤–ª—è—î—Ç—å—Å—è –ø—ñ—Å–ª—è —Ç–µ–∫—Å—Ç—É */}
          {showCarpet && (
            <div id="carpet" ref={carpetRef} >
              <img src={Carpet} alt="Carpet" />
            </div>
          )}
        </div>
      </div>
    </div>
  );
}

export default App;

/* –ê –∂—ñ–Ω–∫–∞ –±—É–≤–∞—î –Ω–∞ –æ—Å—ñ–Ω—å —Ç–∞–∫ —Å—Ö–æ–∂–∞:
–¢–æ —Ç–∏—Ö–∞ –π –ø—Ä–∏–≤—ñ—Ç–Ω–∞, –∞ —Ç–æ –Ω–µ–ø–æ–≥–æ–∂–∞,
–¢–æ —Å–∫—Ä–æ–ø–∏—Ç—å —Å–ª—å–æ–∑–æ—é, —Ç–æ —Å–æ–Ω—Ü–µ–º –∑–∞—Å–≤—ñ—Ç–∏—Ç—å,
–¢–æ –ø—Ä–∞–≥–Ω–µ –∑–∏–º–∏, —Ç–æ –≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –≤ –ª—ñ—Ç–æ.

–ê –∂—ñ–Ω–∫–∞, —è–∫ –æ—Å—ñ–Ω—å, –ø–ª–æ–¥–∞–º–∏ –±–∞–≥–∞—Ç–∞:
–ù–∞ –Ω—ñ–∂–Ω—ñ—Å—Ç—å, –¥–æ–±—Ä–æ, –º–∞—Ç–µ—Ä–∏–Ω—Å—Ç–≤–æ —ñ —Å–≤—è—Ç–æ,
–Ø–∫ –≤–µ—Ä–µ—Å–µ–Ω—å —Ç–∏—Ö–∏–π, –∑—ñ–≥—Ä—ñ—î –¥—É—à–µ—é ‚Äî
–ù–µ —Å—Ç—Ä–∞—à–Ω–æ –Ω–µ–≥–æ–¥—É —á–µ–∫–∞—Ç–∏ —ñ–∑ –Ω–µ—é!

–ê –∂—ñ–Ω–∫–∞ –±—É–≤–∞—î —Ç—Ä–∏–≤–æ–∂–Ω–∞, —è–∫ –æ—Å—ñ–Ω—å:
–¢–æ –¥–∏—Ö–∞—î –≤—ñ—Ç—Ä–æ–º, —Ç–æ –ª–∞—Å–∫–∏ –ø–æ–ø—Ä–æ—Å–∏—Ç—å,
–¢–æ –±–æ–ª—é –∑–∞–≤–¥–∞—Å—Ç—å, –∞ —Ç–æ –≤–∏–≥–æ—ó—Ç—å —Ä–∞–Ω–∏,
–õ–∏—Å—Ç–æ—á–∫–æ–º —É —Å–≤—ñ—Ç –ø–æ–ª–µ—Ç–∏—Ç—å –∑–∞ –∫–æ—Ö–∞–Ω–∏–º!

–ê –æ—Å—ñ–Ω—å –≤ –ø—Ä–∏—Ä–æ–¥—ñ ‚Äî –Ω–µ–∑–≤—ñ–¥–∞–Ω–µ –¥–∏–≤–æ,
–¢–∞–∫ —Å–∞–º–æ —ñ –∂—ñ–Ω–∫–∞: –±—É–≤–∞—î –≤—Ä–æ–¥–ª–∏–≤–∞,
–ë—É–≤–∞—î –ø—Ä–∏–º—Ö–ª–∏–≤–∞, –±—É–≤–∞—î —á—É—Ç–ª–∏–≤–∞,
–ù–µ—Ö–∞–π —Ç—ñ–ª—å–∫–∏ –∫–æ–∂–Ω–∞ –∑ –Ω–∏—Ö –±—É–¥–µ —â–∞—Å–ª–∏–≤–∞!
/////////////////
–ù–µ—Ö–∞–π —Ç–µ–Ω–¥—ñ—Ç–Ω—ñ –ø–∞—Ö–æ—â—ñ —Ç—Ä–æ—è–Ω–¥
–ù–∞–≤—ñ—é—Ç—å —â–∞—Å—Ç—è, –Ω—ñ–∂–Ω—ñ—Å—Ç—å —ñ –∫–æ—Ö–∞–Ω–Ω—è,
–•–∞–π –∑–¥—ñ–π—Å–Ω—é—î –±–∞–∂–∞–Ω–Ω—è –∑–æ—Ä–µ–ø–∞–¥
–Ü –≤—Ç—ñ–ª—é—î —É –¥—ñ–π—Å–Ω—ñ—Å—Ç—å —Å–ø–æ–¥—ñ–≤–∞–Ω–Ω—è!
–•–∞–π –≤–∞–º –≤–¥–∞—î—Ç—å—Å—è –≤—Å–µ ‚Äî –≤–¥–µ–Ω—å —ñ –≤–Ω–æ—á—ñ,
–•–∞–π –æ—á—ñ –ø–æ—Å–º—ñ—Ö–∞—é—Ç—å—Å—è –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω–æ,
–Ü —Å–º–∞–∫ –∂–∏—Ç—Ç—è, —ñ –º–æ–ª–æ–¥—ñ—Å—Ç—å –¥—É—à—ñ
–ù–µ—Ö–∞–π –¥–ª—è –≤–∞—Å —Ç—Ä–∏–≤–∞—é—Ç—å –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–æ!
*/